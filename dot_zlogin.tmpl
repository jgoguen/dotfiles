# vim: set filetype=zsh:
# Do not edit this file directly! It is managed by chezmoi.

if [ -z "${TERM}" ] || [ "${TERM}" = "vscode" ] || [[ ! -o interactive ]]; then
	return
fi

autoload zkbd
[ ! -f "${ZDOTDIR:-$HOME}/.zkbd/$TERM" ] && {
	zkbd
	# shellcheck disable=SC2039
	mv "${ZDOTDIR:-$HOME}/.zkbd/$TERM-${${DISPLAY:t}:-$VENDOR-$OSTYPE}" "${ZDOTDIR:-$HOME}/.zkbd/$TERM"
}
# shellcheck source={{ .chezmoi.homeDir }}/.zkbd/xterm-256color
. "${ZDOTDIR:-$HOME}/.zkbd/$TERM"

[ -n "${key[Backspace]}" ] && bindkey "${key[Backspace]}" backward-delete-char
[ -n "${key[Insert]}" ] && bindkey "${key[Insert]}" overwrite-mode
[ -n "${key[Home]}" ] && bindkey "${key[Home]}" beginning-of-line
[ -n "${key[PageUp]}" ] && bindkey "${key[PageUp]}" up-line-or-history
[ -n "${key[Delete]}" ] && bindkey "${key[Delete]}" delete-char
[ -n "${key[End]}" ] && bindkey "${key[End]}" end-of-line
[ -n "${key[PageDown]}" ] && bindkey "${key[PageDown]}" down-line-or-history
[ -n "${key[Up]}" ] && bindkey "${key[Up]}" up-line-or-search
[ -n "${key[Left]}" ] && bindkey "${key[Left]}" backward-char
[ -n "${key[Down]}" ] && bindkey "${key[Down]}" down-line-or-search
[ -n "${key[Right]}" ] && bindkey "${key[Right]}" forward-char

# Scroll up in tmux on PageUp.
_tmux_copy_mode() {
	tmux copy-mode -eu
}
zle -N _tmux_copy_mode
[[ $TMUX_PANE && -n "${key[PageUp]}" ]] && bindkey "${key[PageUp]}" _tmux_copy_mode

if command -v starship >/dev/null 2>&1; then
	eval $(starship init zsh)
	eval $(starship completions zsh)
fi

if command -v op >/dev/null 2>&1; then
	eval $(op completion zsh)
fi

if command -v brew >/dev/null 2>&1; then
	BREW_PREFIX="$(brew --prefix)"
	if [ -f "${BREW_PREFIX}/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ]; then
		source "${BREW_PREFIX}/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
	fi

	if [ -f "${BREW_PREFIX}/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]; then
		source "${BREW_PREFIX}/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
	fi

	for f in "${BREW_PREFIX}/"Cellar/fzf/*/shell/key-bindings.zsh; do
		if [ -f "${f}" ]; then
			source "${f}"
		fi
	done
fi

for f in /usr/local/share/fzf/shell/key-bindings.zsh /usr/share/fzf/shell/key-bindings.zsh; do
	if [ -f "${f}" ]; then
		source "${f}"
	fi
done

# Print out some stuff before the terminal prompt unless this is a chezmoi
# subshell
if [ -z "${CHEZMOI:-}" ]; then
	uptime
	printf "\n"
	if command -v fortune >/dev/null 2>&1; then
		fortune -n 512 -s
	fi
fi
