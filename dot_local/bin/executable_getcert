#!/bin/sh
# Do not edit this file directly! It is managed by chezmoi.

HOSTNAME=""
PORT="443"

while getopts ":h:p:" opt; do
	case "${opt}" in
	h)
		HOSTNAME="${OPTARG}"
		;;
	p)
		PORT="${OPTARG}"
		;;
	*) ;;
	esac
done
shift $((OPTIND - 1))

# Support both `$0 host port` and `$0 host:port`
if [ $# -gt 0 ]; then
	HOSTNAME="${1%:*}"
	portarg="${1##*:}"
	if [ "${HOSTNAME}" != "${portarg}" ]; then
		PORT="${portarg}"
	fi
	if [ -n "${2}" ]; then
		PORT="${2}"
	fi
fi

if [ -z "${HOSTNAME}" ]; then
	printf 'You must give a hostname\n' >&2
	exit 1
fi

openssl s_client -connect "${HOSTNAME}:${PORT}" -servername "${HOSTNAME}" \
	</dev/null 2>/dev/null | sed -ne '/-BEGIN CERT/,/-END CERT/p'
