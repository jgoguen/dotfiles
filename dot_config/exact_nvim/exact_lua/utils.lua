-- Do not edit this file directly! It is managed by chezmoi.

local M = {
	cmp_source_priority = {
		nvim_lsp = 1000,
		nvim_lsp_signature_help = 900,
		omni = 800,
		luasnip = 750,
		emoji = 700,
		pandoc_references = 700,
		latex_symbols = 700,
		calc = 650,
		path = 500,
		buffer = 250,
	},
	excluded_filetypes = {
		'dashboard',
		'neogitstatus',
		'NvimTree',
		'neo-tree',
		'neo-tree-popup',
		'notify',
		'packer',
		'TelescopePrompt',
		'Trouble',
	},
	excluded_buftypes = {
		'nofile',
		'prompt',
		'quickfix',
		'terminal',
	},
	project_root_files = {
		'Makefile',
		'.git',
		'.hg',
	},
}

-- Take the cmp source string or table and return a source table.
-- See nvim-cmp documentation for the format of the source table.
function M.get_cmp_source(source)
	local cmp_src = type(source) == 'string' and {name = source} or source

	local priority = M.cmp_source_priority[cmp_src.name]
	if priority then
		cmp_src.priority = priority
	end

	return cmp_src
end

-- Takes a cmp source table and adds it to nvim-cmp
function M.add_cmp_source(source)
	local has_cmp, cmp = pcall(require, 'cmp')
	if not has_cmp then return end

	local config = cmp.get_config()
	table.insert(config.sources, source)

	cmp.setup(config)
end

function M.get_icon(name)
	local icons = require('config.icons')
	return icons[name] or ''
end

function M.lspkind_opts()
	return {
		mode = 'symbol_text',
		symbol_map = {
			NONE = '',
			Array = M.get_icon('Array'),
			Boolean = M.get_icon('Boolean'),
			Class = M.get_icon('Class'),
			Constructor = M.get_icon('Build'),
			Key = M.get_icon('Key'),
			Namespace = M.get_icon('Array'),
			Null = 'NULL',
			Number = '#',
			Object = M.get_icon('BorderFilledCircle'),
			Package = M.get_icon('Package'),
			Property = M.get_icon('Setting'),
			Reference = M.get_icon('Link'),
			Snippet = M.get_icon('Cut'),
			String = M.get_icon('Font'),
			TypeParameter = M.get_icon('TypeParameter'),
			Unit = M.get_icon('AngleRuler'),
		},
	}
end

function M.set_keymap(mode, key, val, opts)
	local options = {noremap = true, silent = true}
	if opts then
		options = vim.tbl_extend('force', options, opts)
	end

	vim.keymap.set(mode, key, val, options)
end

function M.invert(mapping)
	local result = {}
	for k, v in pairs(mapping) do
		result[v] = k
	end
	return result
end

-- Opens a floating window
-- opts:
--	- width: int (0,1]: Percentage of the editor width for the window
--	- height: int (0,1]: Percentage of the editor height for the window
--	- border: Window border style (none, single, double, rounded, solid, shadow)
-- How to add content to the new window:
--	local buf = floating_window(opts)
--	vim.api.nvim_buf_set_lines(buf, 0, -1, true, <string content>)
function M.floating_window(opts)
	local default_config = {
		width = 0.8,
		height = 0.8,
		border = 'rounded',
	}
	opts = vim.tbl_extend('force', default_config, opts)

	local total_width = vim.api.nvim_get_option("columns")
	local total_height = vim.api.nvim_get_option("lines")
	local win_width = opts.width <= 1 and math.ceil(total_width * opts.width) or total_width
	local win_height = opts.height <= 1 and math.ceil(total_height * opts.height) or total_height
	local win_opts = {
		relative = 'editor',
		width = win_width,
		height = win_height,
		row = math.ceil((total_height - win_height) / 2 - 1),
		col = math.ceil(total_width - win_width) / 2,
		focusable = true,
		style = 'minimal',
		border = opts.border,
	}
	local buf = vim.api.nvim_create_buf(false, true)

	vim.api.nvim_open_win(buf, true, win_opts)
	vim.api.nvim_win_set_option(0, "wrap", true)

	return buf
end

return M
